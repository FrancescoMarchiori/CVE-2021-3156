#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>

int main(int argc, char** argv, char** envp){

    // Buffer where copy user input arguments with escaped characters
    char* user_args;

    // Copy the set of pointers for each command-line argument
    char** NewArgv= (char**) malloc((argc+1) * sizeof(char*));    
    if(NewArgv == NULL){
        puts("Error 1");
        exit(0);
    }
    for(int i=0; i <= argc; i++)
        NewArgv[i]= argv[i];

    char *to, *from, **av;
    size_t size, n;

    for (size = 0, av = NewArgv + 1; *av; av++)
        size += strlen(*av) + 1;

    if (size == 0 || (user_args = (char*) malloc(size)) == NULL){
        puts("Error 2");
        exit(0);
    }
    
    int actual_copied= 0;

    for (to = user_args, av = NewArgv + 1; (from = *av); av++) {
        while (*from) {
            if (from[0] == '\\' && !isspace((unsigned char)from[1]) && from[1] != '\0')
                from++;
            *to++ = *from++;
	    actual_copied++;
        }
        *to++ = ' ';
	actual_copied++;
    }
    *--to = '\0';
   
    for(int i= 0; i< actual_copied; i++)
	    printf("user_args[%i]: %c\n", i, user_args[i]);